"use client";
import { fetchpayments } from "@/actions/userActions";
import { useSession } from "next-auth/react";
import { useEffect, useState } from "react";

const Page = () => {
  const { data: session, status } = useSession();
  const [payments, setPayments] = useState(null);

  const getPaymentData = async () => {
    const p = await fetchpayments(session?.user.username);
    setPayments(p);
  };

  useEffect(() => {
    if (status === "authenticated") {
      getPaymentData();
    }
  }, [status]);

  return (
    <div className="flex flex-col mt-10 w-full items-center gap-6 text-[#676b5f]">
      {/* Support Analytics */}
      <div className="flex gap-2 w-full">
        <div className="flex w-1/2 flex-col gap-2 rounded-xl bg-white p-5">
          <p className="text-gray-800 text-3xl font-semibold">
            {/* finds unique supporter names */}
            {
              [
                ...new Set(
                  payments?.map((item) => {
                    return item.name;
                  })
                ),
              ].length
            }
          </p>
          <div className="flex gap-3 items-center">
            <svg
              width="14"
              height="14"
              viewBox="0 0 14 14"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M6.841 12.9025C5.39392 12.0119 4.04773 10.9638 2.82652 9.77678C1.96795 8.92196 1.31433 7.87985 0.915723 6.73026C0.198421 4.5002 1.03628 1.94722 3.38107 1.19168C4.6134 0.794957 5.95929 1.0217 6.99772 1.80098C8.03655 1.02265 9.38197 0.795985 10.6144 1.19168C12.9592 1.94722 13.803 4.5002 13.0857 6.73026C12.6871 7.87985 12.0335 8.92196 11.1749 9.77678C9.95374 10.9638 8.60754 12.0119 7.16047 12.9025L7.00375 13L6.841 12.9025Z"
                stroke="#717171"
                strokeLinecap="round"
                strokeLinejoin="round"
              ></path>
              <path
                d="M9.49316 3.70215C10.2034 3.92902 10.708 4.56662 10.771 5.3168"
                stroke="#717171"
                strokeLinecap="round"
                strokeLinejoin="round"
              ></path>
            </svg>
            <span className="w-full">Supporter</span>
          </div>
        </div>
        <div className="flex w-1/2 flex-col gap-2 rounded-xl bg-white p-5">
          <p className="text-gray-800 text-3xl font-semibold">
            â‚¹ { payments?payments?.reduce((total, item) =>total + parseInt(item.amount),0).toLocaleString('en-IN'):0}
          </p>
          <div className="flex gap-3 items-center">
            <svg
              width="16"
              height="16"
              viewBox="0 0 13 13"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M6.48471 9.5C6.56812 9.5 6.62373 9.43523 6.62373 9.32273V8.90682C7.42447 8.84886 8 8.32727 8 7.46477C8 6.71818 7.60241 6.34318 6.84059 6.13182L6.62373 6.07386V4.87386C6.89064 4.91818 7.0658 5.08523 7.17424 5.36477C7.26321 5.5625 7.38276 5.66136 7.55514 5.66136C7.76645 5.66136 7.90547 5.51477 7.90547 5.28977C7.90547 5.21818 7.89435 5.15 7.87766 5.08182C7.74421 4.55682 7.28545 4.15795 6.62373 4.10341V3.67727C6.62373 3.56477 6.56812 3.5 6.48471 3.5C6.4013 3.5 6.34569 3.56477 6.34569 3.67727V4.10341C5.56997 4.15114 5.0139 4.68295 5.0139 5.50455C5.0139 6.24091 5.41149 6.63977 6.13994 6.84091L6.34569 6.89886V8.13977C5.99537 8.10227 5.8202 7.90795 5.73123 7.64205C5.65338 7.44432 5.53661 7.33523 5.36423 7.33523C5.13624 7.33523 5 7.50227 5 7.74773C5 7.8125 5.01112 7.88409 5.03336 7.9625C5.1696 8.46023 5.63114 8.86591 6.34569 8.90682V9.32273C6.34569 9.43523 6.4013 9.5 6.48471 9.5ZM5.7924 5.41591C5.7924 5.13977 5.98146 4.91136 6.34569 4.87045V5.99545C5.95644 5.87273 5.7924 5.69205 5.7924 5.41591ZM7.22428 7.57045C7.22428 7.88409 7.0241 8.10227 6.62373 8.13977V6.97727C7.06858 7.11364 7.22428 7.26705 7.22428 7.57045Z"
                fill="#717171"
              ></path>
              <circle cx="6.5" cy="6.5" r="5.5" stroke="#717171"></circle>
            </svg>
            <span className="w-full">All-time</span>
          </div>
        </div>
      </div>
      {/* no supports yet */}
      {!payments && (
        <div className="flex flex-col gap-3 items-center text-center">
          <div className="p-5 bg-white rounded-full">
            <svg
              width="24"
              height="19"
              viewBox="0 0 24 19"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fillRule="evenodd"
                clipRule="evenodd"
                d="M3.48215 12.9301C0.987109 10.8102 -0.251211 7.86738 0.0424688 4.58002C0.533749 -0.916945 8.03351 -0.988304 11.5333 1.85266C15.1513 -1.06574 23.0497 -0.810705 23.0615 5.02386C23.0681 8.40434 21.878 11.1178 19.2141 13.2207C18.274 13.9628 17.2524 14.5854 16.2313 15.2077C15.9023 15.4083 15.5733 15.6088 15.2471 15.8132C14.9379 16.0069 14.5798 16.2993 14.1975 16.6114C13.3367 17.3142 12.3537 18.1167 11.532 18.1167C10.6631 18.1167 9.54621 17.219 8.576 16.4391C8.13326 16.0833 7.72108 15.7519 7.37695 15.5417C7.20162 15.4347 7.02551 15.328 6.84914 15.2213C5.68827 14.5184 4.51603 13.8087 3.48215 12.9301ZM10.7631 4.13354C9.39199 2.50874 6.94007 1.71898 4.85671 2.2677C2.25207 2.95394 1.70679 5.18962 2.44271 7.6449C3.12975 9.93626 4.78935 11.3687 6.75783 12.6044C7.13497 12.8409 7.51561 13.0722 7.89627 13.3034C8.53672 13.6925 9.17721 14.0816 9.80111 14.4959L9.82465 14.5115C10.1123 14.7019 11.1213 15.3696 11.4781 15.7204C11.6535 15.5516 12.0152 15.325 12.2309 15.1899C12.2982 15.1478 12.3512 15.1146 12.3801 15.0947C12.8174 14.7928 13.256 14.4939 13.7068 14.2115C14.0736 13.9815 14.4443 13.7567 14.815 13.5319C15.4557 13.1435 16.0966 12.7549 16.7187 12.3387C18.6197 11.0672 20.3459 9.49906 20.7414 7.12546C21.1495 4.67738 20.5051 2.37906 17.6677 2.17066C15.6391 2.02146 13.6501 2.5349 12.3013 4.13354C12.0685 4.40946 11.7953 4.50994 11.532 4.49298C11.2692 4.50994 10.9954 4.40938 10.7631 4.13354Z"
                fill="#717171"
              ></path>
            </svg>
          </div>
          <p className="font-semibold text-black">
            You don't have any supporters yet
          </p>
          <p>Share your page with your audience to get started.</p>
        </div>
      )}

      {/* leaderboard */}
      {payments && (
        <div className="flex flex-col w-full items-center gap-5">
          <div className="flex gap-2">
            <svg
              className="text-[#676b5f]"
              width="29"
              fill="#676b5f"
              height="47"
              viewBox="0 0 29 47"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clipPath="url(#clip0_1849_1143)">
                <path d="M3.25191 10.2994C1.97676 7.16651 3.06799 3.47663 5.94524 0.825439C6.32941 3.51013 4.82949 8.78738 3.25191 10.2994Z"></path>
                <path d="M22.8982 43.5879C20.9773 45.9627 16.8903 46.2558 14.4912 44.1826C17.2418 42.6623 20.025 43.0727 22.8982 43.5879Z"></path>
                <path d="M12.5538 37.653C12.5783 38.0425 13.081 38.0719 13.126 38.4404C11.2991 39.9273 7.71071 39.0729 6.32113 36.8782C5.92469 36.2499 6.08817 36.028 6.74209 35.9777C8.56489 35.8311 10.2119 36.3798 11.7773 37.2761C12.0347 37.4227 12.2227 37.72 12.5701 37.6782L12.5497 37.6572L12.5538 37.653Z"></path>
                <path d="M9.29287 34.4743C7.78477 34.6251 6.52189 34.5036 5.2917 34.089C3.97978 33.6492 3.26046 32.6943 3.03159 31.3079C2.91307 30.5834 3.06838 30.2692 3.84899 30.5499C5.97014 31.3121 7.60494 32.7571 9.29287 34.4743Z"></path>
                <path d="M6.00697 29.5698C3.24416 29.6284 0.99631 27.8107 0.742916 25.3564C0.661177 24.5564 0.836917 24.3554 1.60119 24.6779C3.23598 25.3647 5.31218 27.6306 6.00697 29.5698Z"></path>
                <path d="M12.5747 37.6698C11.9575 36.74 11.1974 35.9107 10.8418 34.8008C10.3146 33.1674 10.4045 31.7769 11.2301 30.6125C12.9834 32.5015 13.4738 34.7338 13.1101 37.23C13.061 37.5609 12.873 37.6949 12.5542 37.6531L12.5747 37.674V37.6698Z"></path>
                <path d="M10.5186 40.9074C12.5988 39.9944 15.9338 40.3378 17.9365 41.6404C15.8848 43.3115 12.5539 43.0141 10.5186 40.9074Z"></path>
                <path d="M9.74975 30.4535C9.77427 31.3582 9.63123 32.2377 9.37374 33.1005C9.2307 33.5821 9.07539 33.645 8.71165 33.268C7.3752 31.8859 7.07685 28.5311 8.12312 26.839C8.46235 26.2903 8.64217 26.4914 8.87513 26.8934C9.50862 27.9908 9.79471 29.1803 9.75384 30.4535H9.74975Z"></path>
                <path d="M21.0547 45.8663C21.7658 45.0287 22.7712 44.8863 23.7071 44.8025C25.0109 44.6852 26.331 44.7899 27.6429 44.7732C28.305 44.7648 28.1824 45.1082 27.9781 45.4768C27.6388 46.0799 27.0667 46.3982 26.4536 46.5993C24.9455 47.0935 22.5832 46.7626 21.0588 45.8705L21.0547 45.8663Z"></path>
                <path d="M17.4092 40.8654C15.3126 40.0026 14.017 37.7954 14.3031 35.8479C14.4339 34.9558 14.8017 35.0144 15.3657 35.3871C16.0727 35.8562 16.5019 36.5599 16.8125 37.3347C17.2498 38.432 17.446 39.5838 17.4051 40.8612L17.4092 40.8654Z"></path>
                <path d="M22.1251 43.0223C20.0326 42.6496 18.3651 40.9114 18.1485 38.922C18.0627 38.1179 18.2793 37.9294 19.0395 38.2267C20.805 38.9178 22.072 40.8319 22.1251 43.0223Z"></path>
                <path d="M28.1091 44.3879C25.898 44.4508 23.8423 43.2361 23.2783 41.5399C23.1556 41.1755 22.9636 40.7357 23.2374 40.4593C23.4826 40.2122 23.8709 40.5221 24.1733 40.6268C26.5479 41.4729 27.6677 42.5576 28.1132 44.3837L28.1091 44.3879Z"></path>
                <path d="M5.9369 28.4137C5.24211 27.0693 5.08272 25.7123 5.22168 24.2966C5.2789 23.7312 5.44646 23.2118 5.76116 22.7469C5.94916 22.4663 6.12899 22.0643 6.48865 22.1103C6.79109 22.148 6.8483 22.571 6.96274 22.8517C7.71883 24.6903 7.33057 26.8598 5.9369 28.4137Z"></path>
                <path d="M3.02302 14.8729C1.0163 14.0478 0.374643 10.3118 1.40048 7.95801C3.11293 10.0019 3.1211 12.3683 3.02302 14.8729Z"></path>
                <path d="M0.640614 18.7764C2.62689 19.8528 3.2849 21.7919 3.80803 23.8065C3.93473 24.3007 3.57099 24.1709 3.3176 24.1039C1.25366 23.551 -0.103219 20.8998 0.640614 18.7764Z"></path>
                <path d="M3.38683 18.3451C3.17022 16.2049 3.80779 14.5128 5.33632 13.1768C5.52432 13.0134 5.74502 12.7328 6.03111 12.9087C6.24772 13.0427 6.21094 13.3401 6.23137 13.5788C6.40711 15.4887 5.36493 17.2897 3.38683 18.3409V18.3451Z"></path>
                <path d="M3.10912 19.0446C0.987974 18.8226 -0.413865 16.4521 0.35449 14.182C0.587448 13.4868 0.926669 13.9517 1.14737 14.1736C2.28355 15.317 2.69225 16.8123 3.01921 18.3452C3.06825 18.5713 3.08052 18.8017 3.10912 19.0488V19.0446Z"></path>
                <path d="M6.16966 17.7629C7.04428 19.2121 5.6547 21.9303 4.45312 22.9103C4.12616 23.1784 3.8932 23.1616 3.77059 22.6339C3.33329 20.7827 4.40408 18.5629 6.16966 17.7629Z"></path>
                <path d="M6.57087 8.72886C6.26843 10.7644 5.28346 12.2847 3.76719 13.47C3.44023 13.7255 3.14188 13.7297 3.22362 13.2187C3.53832 11.2879 4.2045 9.5372 5.8066 8.3184C5.98643 8.18019 6.21939 7.92889 6.42373 8.11737C6.56269 8.24301 6.53408 8.56132 6.56678 8.72886H6.57087Z"></path>
              </g>
              <defs>
                <clipPath id="clip0_1849_1143">
                  <rect
                    width="28"
                    height="46"
                    fill="#676b5f"
                    transform="translate(0.141602 0.825439)"
                  ></rect>
                </clipPath>
              </defs>
            </svg>
            <div className="flex flex-col items-center">
              <span className="font-bold text-black">{payments?.length}</span>
              <span className="text-black">Donations</span>
            </div>
            <svg
              className="transform -scale-x-[1]"
              width="29"
              height="47"
              fill="#676b5f"
              viewBox="0 0 29 47"
              xmlns="http://www.w3.org/2000/svg"
            >
              <g clipPath="url(#clip0_1849_1143)">
                <path d="M3.25191 10.2994C1.97676 7.16651 3.06799 3.47663 5.94524 0.825439C6.32941 3.51013 4.82949 8.78738 3.25191 10.2994Z"></path>
                <path d="M22.8982 43.5879C20.9773 45.9627 16.8903 46.2558 14.4912 44.1826C17.2418 42.6623 20.025 43.0727 22.8982 43.5879Z"></path>
                <path d="M12.5538 37.653C12.5783 38.0425 13.081 38.0719 13.126 38.4404C11.2991 39.9273 7.71071 39.0729 6.32113 36.8782C5.92469 36.2499 6.08817 36.028 6.74209 35.9777C8.56489 35.8311 10.2119 36.3798 11.7773 37.2761C12.0347 37.4227 12.2227 37.72 12.5701 37.6782L12.5497 37.6572L12.5538 37.653Z"></path>
                <path d="M9.29287 34.4743C7.78477 34.6251 6.52189 34.5036 5.2917 34.089C3.97978 33.6492 3.26046 32.6943 3.03159 31.3079C2.91307 30.5834 3.06838 30.2692 3.84899 30.5499C5.97014 31.3121 7.60494 32.7571 9.29287 34.4743Z"></path>
                <path d="M6.00697 29.5698C3.24416 29.6284 0.99631 27.8107 0.742916 25.3564C0.661177 24.5564 0.836917 24.3554 1.60119 24.6779C3.23598 25.3647 5.31218 27.6306 6.00697 29.5698Z"></path>
                <path d="M12.5747 37.6698C11.9575 36.74 11.1974 35.9107 10.8418 34.8008C10.3146 33.1674 10.4045 31.7769 11.2301 30.6125C12.9834 32.5015 13.4738 34.7338 13.1101 37.23C13.061 37.5609 12.873 37.6949 12.5542 37.6531L12.5747 37.674V37.6698Z"></path>
                <path d="M10.5186 40.9074C12.5988 39.9944 15.9338 40.3378 17.9365 41.6404C15.8848 43.3115 12.5539 43.0141 10.5186 40.9074Z"></path>
                <path d="M9.74975 30.4535C9.77427 31.3582 9.63123 32.2377 9.37374 33.1005C9.2307 33.5821 9.07539 33.645 8.71165 33.268C7.3752 31.8859 7.07685 28.5311 8.12312 26.839C8.46235 26.2903 8.64217 26.4914 8.87513 26.8934C9.50862 27.9908 9.79471 29.1803 9.75384 30.4535H9.74975Z"></path>
                <path d="M21.0547 45.8663C21.7658 45.0287 22.7712 44.8863 23.7071 44.8025C25.0109 44.6852 26.331 44.7899 27.6429 44.7732C28.305 44.7648 28.1824 45.1082 27.9781 45.4768C27.6388 46.0799 27.0667 46.3982 26.4536 46.5993C24.9455 47.0935 22.5832 46.7626 21.0588 45.8705L21.0547 45.8663Z"></path>
                <path d="M17.4092 40.8654C15.3126 40.0026 14.017 37.7954 14.3031 35.8479C14.4339 34.9558 14.8017 35.0144 15.3657 35.3871C16.0727 35.8562 16.5019 36.5599 16.8125 37.3347C17.2498 38.432 17.446 39.5838 17.4051 40.8612L17.4092 40.8654Z"></path>
                <path d="M22.1251 43.0223C20.0326 42.6496 18.3651 40.9114 18.1485 38.922C18.0627 38.1179 18.2793 37.9294 19.0395 38.2267C20.805 38.9178 22.072 40.8319 22.1251 43.0223Z"></path>
                <path d="M28.1091 44.3879C25.898 44.4508 23.8423 43.2361 23.2783 41.5399C23.1556 41.1755 22.9636 40.7357 23.2374 40.4593C23.4826 40.2122 23.8709 40.5221 24.1733 40.6268C26.5479 41.4729 27.6677 42.5576 28.1132 44.3837L28.1091 44.3879Z"></path>
                <path d="M5.9369 28.4137C5.24211 27.0693 5.08272 25.7123 5.22168 24.2966C5.2789 23.7312 5.44646 23.2118 5.76116 22.7469C5.94916 22.4663 6.12899 22.0643 6.48865 22.1103C6.79109 22.148 6.8483 22.571 6.96274 22.8517C7.71883 24.6903 7.33057 26.8598 5.9369 28.4137Z"></path>
                <path d="M3.02302 14.8729C1.0163 14.0478 0.374643 10.3118 1.40048 7.95801C3.11293 10.0019 3.1211 12.3683 3.02302 14.8729Z"></path>
                <path d="M0.640614 18.7764C2.62689 19.8528 3.2849 21.7919 3.80803 23.8065C3.93473 24.3007 3.57099 24.1709 3.3176 24.1039C1.25366 23.551 -0.103219 20.8998 0.640614 18.7764Z"></path>
                <path d="M3.38683 18.3451C3.17022 16.2049 3.80779 14.5128 5.33632 13.1768C5.52432 13.0134 5.74502 12.7328 6.03111 12.9087C6.24772 13.0427 6.21094 13.3401 6.23137 13.5788C6.40711 15.4887 5.36493 17.2897 3.38683 18.3409V18.3451Z"></path>
                <path d="M3.10912 19.0446C0.987974 18.8226 -0.413865 16.4521 0.35449 14.182C0.587448 13.4868 0.926669 13.9517 1.14737 14.1736C2.28355 15.317 2.69225 16.8123 3.01921 18.3452C3.06825 18.5713 3.08052 18.8017 3.10912 19.0488V19.0446Z"></path>
                <path d="M6.16966 17.7629C7.04428 19.2121 5.6547 21.9303 4.45312 22.9103C4.12616 23.1784 3.8932 23.1616 3.77059 22.6339C3.33329 20.7827 4.40408 18.5629 6.16966 17.7629Z"></path>
                <path d="M6.57087 8.72886C6.26843 10.7644 5.28346 12.2847 3.76719 13.47C3.44023 13.7255 3.14188 13.7297 3.22362 13.2187C3.53832 11.2879 4.2045 9.5372 5.8066 8.3184C5.98643 8.18019 6.21939 7.92889 6.42373 8.11737C6.56269 8.24301 6.53408 8.56132 6.56678 8.72886H6.57087Z"></path>
              </g>
              <defs>
                <clipPath id="clip0_1849_1143">
                  <rect
                    width="28"
                    height="46"
                    fill="#676b5f"
                    transform="translate(0.141602 0.825439)"
                  ></rect>
                </clipPath>
              </defs>
            </svg>
          </div>
          <p className="text-sm">Top supporters from the last 90 adys</p>
          <div className="flex gap-3 w-full items-end">
            <div className="gap-2 w-1/3 flex flex-col items-center">
              <img className="h-10" src="/second.png" alt="2nd" />
              <div className="text-center">{payments[1]?payments[1].name:"--"}</div>
            </div>
            <div className="gap-2 w-1/3 flex flex-col items-center">
              <img className="h-16" src="/first.png" alt="1st" />
              <div className="text-center">{payments[0]?payments[0].name:"--"}</div>
            </div>
            <div className="gap-2 w-1/3 flex flex-col items-center">
              <img className="h-10" src="/third.png" alt="3rd" />
              <div className="text-center">{payments[2]?payments[2].name:"--"}</div>
            </div>
          </div>

          {/* Recent Supporters */}
          <div className="bg-white w-full flex flex-col gap-3 rounded-3xl p-3">
            <h2 className="font-medium text-xl text-black">
              Recent supporters
            </h2>
            {payments?.map((item,index)=>{
              return <div key={index} className="flex gap-2">
              <img
                src="/defaultprofile.webp"
                className="w-10 h-10 rounded-full"
                alt="userpic"
              />
              <div className="flex flex-col gap-2">
                <p>
                  <span className="text-black font-medium">{item.name}</span>{" "}
                  bought {item.amount/50} {item.amount/50===1?"Coffee":"Coffees"}.
                </p>
                <p className="p-2 bg-[#f3f3f1] rounded-xl">
                  {item.message}
                </p>
              </div>
            </div>
            })}
          </div>
        </div>
      )}
    </div>
  );
};

export default Page;
